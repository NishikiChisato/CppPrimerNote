# 信号的表示和处理

- [信号的表示和处理](#信号的表示和处理)
  - [编码](#编码)
    - [无符号(Unsigned)数的编码](#无符号unsigned数的编码)
    - [补码(Two's-complement)数的编码](#补码twos-complement数的编码)
    - [其他编码方式](#其他编码方式)
      - [反码(Ones'Complement)编码](#反码onescomplement编码)
      - [原码(Sign-Magnitude)编码](#原码sign-magnitude编码)
    - [无符号数与补码数的转换](#无符号数与补码数的转换)
      - [补码转无符号](#补码转无符号)
      - [无符号转补码](#无符号转补码)
    - [拓展一个数字的位表示](#拓展一个数字的位表示)
      - [无符号的拓展](#无符号的拓展)
      - [补码数的拓展](#补码数的拓展)
    - [截断数字](#截断数字)
      - [截断无符号数](#截断无符号数)
      - [截断补码数](#截断补码数)
  - [整数运算](#整数运算)
    - [无符号加法](#无符号加法)
      - [无符号加法溢出的检测](#无符号加法溢出的检测)
      - [无符号数的求反](#无符号数的求反)


## 编码

### 无符号(Unsigned)数的编码

设一个整数数据有 $\omega$ 位，我们可以将其写成位向量 $\vec x$ 来表示该向量，或者将其每一位都写出来

$$
\vec x = [x_{\omega -1},x_{\omega -2},\cdots, x_1,x_0]
$$

对于向量 $\vec x = [x_{\omega -1},x_{\omega -2},\cdots, x_1,x_0]$ ，有：

$$
B2U_{\omega}(\vec x)=\sum_{i=0}^{\omega - 1}x_i 2^{i}
$$

### 补码(Two's-complement)数的编码

对于向量 $\vec x = [x_{\omega -1},x_{\omega -2},\cdots, x_1,x_0]$ ，有：

$$
B2T_{\omega}(\vec x)=-x_{\omega - 1}2^{\omega -1}+\sum_{i=0}^{\omega - 2}x_{i}2^{i}
$$

对于补码数的编码，其实就是**无符号数的最高位变为负数**，其余都是一样的

我们以 $4$ 位的无符号数与补码数为例，讨论二者的表示范围：

对于 $4$ 位的无符号数的范围，有：$0\sim 15$

对于 $4$ 位的补码数的范围，有：$-8\sim 7$

对于补码数而言，负数的个数有 $8$ 个，**非负数**的个数也有 $8$ 个，这导致了：$|TMin_{\omega}|=|TMax_{\omega}+1|$

### 其他编码方式

#### 反码(Ones'Complement)编码

$$
B2O_{\omega}(\vec x)=-x_{\omega - 1}(2^{\omega -1}-1)+\sum_{i=0}^{\omega - 2}x_{i}2^{i}
$$

反码编码只是在**补码的基础上**将最高位的权重从 $-2^{\omega -1}$ 变为 $-(2^{\omega}-1)$，其余都跟补码一样

#### 原码(Sign-Magnitude)编码

$$
B2S_{\omega}(\vec x)=(-1)^{x_{\omega -1}}+\sum_{i=0}^{\omega - 2}x_{i}2^{i}
$$

原码的最高位为**符号位**，其余位来决定该数的大小

这两种编码都有一个问题是，对于数字 $0$ 会有两种解释方式

在原码中 $[00\cdots 0]$ 被解释为 $+0$，$[10\cdots 0]$ 被解释为 $-0$

在反码中 $[00\cdots 0]$ 被解释为 $+0$，$[11\cdots 1]$ 被解释为 $-0$

实际上，浮点数的编码方式就是才有原码编码

### 无符号数与补码数的转换

对于补码和无符号数之间的转换，**底层的位值表示是不变的**，只是改变了**解释这些位的方式**

#### 补码转无符号

$$
T2U_{\omega}(\vec x) = \left \{ \begin{matrix}
x+2^{\omega}, & x \lt 0 \\
x,            & x \ge 0
\end{matrix}\right.
$$

#### 无符号转补码

$$
U2T_{\omega}(\vec x) = \left \{ \begin{matrix}
x , & x\le TMax \\
x-2^{\omega} ,& x \gt TMax
\end{matrix}\right.
$$

### 拓展一个数字的位表示

我们主要讨论从一个较小的类型转换到较大的类型

#### 无符号的拓展

无符号的拓展被称为零拓展(zero extention)，只需要简单的在开头添加 $0$ 即可，其原理如下：

定义长度为 $\omega$ 的位向量 $\vec u=[u_{\omega -1},u_{\omega -2},\cdots ,u_1,u_0]$ 和长度为 $\omega '$ 的位向量 $\vec {u'}=[0,0,\cdots ,0,u_{\omega -1},u_{\omega -2},\cdots ,u_1,u_0]$ ，其中 $\omega '\gt \omega$

此时有：$B2U(\vec{u})=B2U(\vec{u'})$

#### 补码数的拓展

补码数的拓展被称为符号拓展(sign extention)，即在前面**添加最高有效位**

最高有效位为 $0$ ，那么添加 $0$ ；最高有效位为 $1$ ，那么添加 $1$

定义长度为 $\omega$ 的位向量 $\vec u=[u_{\omega -1},u_{\omega -2},\cdots ,u_1,u_0]$ 和长度为 $\omega '$ 的位向量 $\vec {u'}=[{\color{orange}u_{\omega -1},u_{\omega -1},\cdots ,u_{\omega -1}},u_{\omega -1},u_{\omega -2},\cdots ,u_1,u_0]$ ，其中 $\omega '\gt \omega$

我们有：$B2T(\vec{u})=B2T(\vec{u'})$

推导：

我们只需证明：$B2T([{\color {orange}u_{\omega -1}},u_{\omega -2},\cdots ,u_1,u_0])=B2T([{\color {orange}u_{\omega -1},u_{\omega -1}},u_{\omega -2},\cdots ,u_1,u_0])$ ，便可以说明对于**任意位数的符号拓展，都是满足条件的**

我们按照补码数的定义展开，有：

$$
\begin{align*}
B2T([{\color {orange}u_{\omega -1},u_{\omega -1}},u_{\omega -2},\cdots ,u_1,u_0])&=-{\color {orange}u_{\omega -1}}2^{\omega}+\sum_{i=0}^{\omega -1}u_{i}2^{i}\\
&=-{\color {orange}u_{\omega -1}}2^{\omega}+{\color {orange}u_{\omega -1}}2^{\omega-1}+\sum_{i=0}^{\omega-2}u_i2^i\\
&=-{\color {orange}u_{\omega -1}}2^{\omega-1}+\sum_{i=0}^{\omega-2}u_i2^i\\
&=B2T([{\color {orange}u_{\omega -1}},u_{\omega -2},\cdots ,u_1,u_0])
\end{align*}
$$

本质上是使用属性：$2^{\omega}-2^{\omega-1}=2^{\omega-1}$

### 截断数字

#### 截断无符号数

设 $\vec{x}$ 表示位向量 $[x_{\omega-1}, x_{\omega-2}, \cdots x_1,x_0]$，$\vec{x'}$为其**截断为 $k$ 位**的结果：$\vec{x'}=[x_{k-1},x_{k-2},\cdots,x_1,x_0]$，我们有：$x'=x\bmod 2^k$

$$
\begin{align*}
B2U_{\omega}([x_{\omega-1}, x_{\omega-2}, \cdots x_1,x_0])\bmod 2^k&=(\sum_{i=0}^{\omega-1}x_i2^{i})\bmod 2^k\\
&=(\sum_{i=0}^{k-1}x_i2^i)\bmod 2^k\\
&=B2U_{\omega}([x_{k-1},x_{k-2},\cdots,x_1,x_0])
\end{align*}
$$

本质上是对于任意的 $i\ge k$，都有：$2^i\bmod 2^k=0$

#### 截断补码数

设 $\vec{x}$ 表示位向量 $[x_{\omega-1}, x_{\omega-2}, \cdots x_1,x_0]$，$\vec{x'}$为其**截断为 $k$ 位**的结果：$\vec{x'}=[x_{k-1},x_{k-2},\cdots,x_1,x_0]$，我们有：$x'=U2T(x\bmod 2^k)$

本质上是先将位向量**截断为 $k$ 位**，然后在**从补码的角度诠释位表示**

## 整数运算

### 无符号加法

设 $0\le x,y\le 2^{\omega}$，有：

$$
\begin{align*}
x+_{\omega}^{u}y=\left \{ \begin{matrix} &x+y,\quad &x+y\le 2^{\omega}\qquad \text{正常}\\
&x+y-2^{\omega},\quad &x+y\ge 2^{\omega}\qquad \text{溢出}
\end{matrix}\right.
\end{align*}
$$

若两个 $\omega$ 位的无符号数相加，如果加和**会自动截断为 $\omega$ 位**

#### 无符号加法溢出的检测

设 $0\le x,y\le UMax_{\omega}$ ，令 $s=x+_{\omega}^{u}y$ ，当且仅当 $s\lt x$ （或等价条件 $s\lt y$）成立时，发生了溢出

代码判断：

```cpp
//未发生溢出时返回true，发生溢出时返回false
bool uadd_ok(unsigned x, unsigned y)
{
    unsigned sum = x + y;
    return sum >= x;
}
```

#### 无符号数的求反

